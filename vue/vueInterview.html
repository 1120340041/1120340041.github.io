<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1. new Vue 发生了什么? | 个人笔记</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.37902ef0.css" as="style"><link rel="preload" href="/assets/js/app.8a76d55b.js" as="script"><link rel="preload" href="/assets/js/30.f6868954.js" as="script"><link rel="prefetch" href="/assets/js/10.a4039df4.js"><link rel="prefetch" href="/assets/js/11.5974f0f8.js"><link rel="prefetch" href="/assets/js/12.27cf8ffd.js"><link rel="prefetch" href="/assets/js/13.fea7540d.js"><link rel="prefetch" href="/assets/js/14.49d72fe0.js"><link rel="prefetch" href="/assets/js/15.8645270f.js"><link rel="prefetch" href="/assets/js/16.d1154499.js"><link rel="prefetch" href="/assets/js/17.be47a230.js"><link rel="prefetch" href="/assets/js/18.e9372b2d.js"><link rel="prefetch" href="/assets/js/19.5bbc7d50.js"><link rel="prefetch" href="/assets/js/2.161ee98d.js"><link rel="prefetch" href="/assets/js/20.a3279ec6.js"><link rel="prefetch" href="/assets/js/21.d2b64f72.js"><link rel="prefetch" href="/assets/js/22.25d3c8a4.js"><link rel="prefetch" href="/assets/js/23.a963db8c.js"><link rel="prefetch" href="/assets/js/24.3b984e2c.js"><link rel="prefetch" href="/assets/js/25.34760acd.js"><link rel="prefetch" href="/assets/js/26.c29fed1c.js"><link rel="prefetch" href="/assets/js/27.481e2c18.js"><link rel="prefetch" href="/assets/js/28.9107ed10.js"><link rel="prefetch" href="/assets/js/29.efe7d57e.js"><link rel="prefetch" href="/assets/js/3.181f599c.js"><link rel="prefetch" href="/assets/js/31.1c2e0c14.js"><link rel="prefetch" href="/assets/js/4.3d49b7f8.js"><link rel="prefetch" href="/assets/js/5.3f264bda.js"><link rel="prefetch" href="/assets/js/6.d2af2d68.js"><link rel="prefetch" href="/assets/js/7.cf51b1fa.js"><link rel="prefetch" href="/assets/js/8.1bdd3edf.js"><link rel="prefetch" href="/assets/js/9.c0163414.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37902ef0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>javaScript</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/vue/vueInterview.html" class="active sidebar-link">vue常见问题</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>babel</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>杂货</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>代码规范</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h3 id="_1-new-vue-发生了什么"><a href="#_1-new-vue-发生了什么" aria-hidden="true" class="header-anchor">#</a> 1. new Vue 发生了什么?</h3> <p>Vue 初始化主要就干了几件事情，合并配置，初始化生命周期，初始化事件中心，初始化渲染，初始化 data、props、computed、watcher 等等</p> <h3 id="_2-vue模版编译成了什么？"><a href="#_2-vue模版编译成了什么？" aria-hidden="true" class="header-anchor">#</a> 2. vue模版编译成了什么？</h3> <p>编译成render函数，render函数的参数是createElement，最后其实还是调用的createElement</p> <h3 id="_3-createelement是用来干嘛的？"><a href="#_3-createelement是用来干嘛的？" aria-hidden="true" class="header-anchor">#</a> 3. createElement是用来干嘛的？</h3> <p>创建VNode的</p> <h3 id="_4-数组vm-items-indexofitem-newvalue这样修改的话vue能监听到数组变动了吗？"><a href="#_4-数组vm-items-indexofitem-newvalue这样修改的话vue能监听到数组变动了吗？" aria-hidden="true" class="header-anchor">#</a> 4. 数组vm.items[indexOfItem] = newValue这样修改的话vue能监听到数组变动了吗？</h3> <p>watch api不能</p> <p>不能，vue并没有监听数组索引或者length的变化，出于性能问题的考虑</p> <h3 id="_5-给对象添加新属性是响应式的吗？如果想是响应式的怎么办？"><a href="#_5-给对象添加新属性是响应式的吗？如果想是响应式的怎么办？" aria-hidden="true" class="header-anchor">#</a> 5. 给对象添加新属性是响应式的吗？如果想是响应式的怎么办？</h3> <p>使用Vue.set</p> <h3 id="_6-什么是vnode？"><a href="#_6-什么是vnode？" aria-hidden="true" class="header-anchor">#</a> 6. 什么是VNode？</h3> <p>其实 VNode 是对真实 DOM 的一种抽象描述，它的核心定义无非就几个关键属性，标签名、数据、子节点、键值等，其它属性都是用来扩展 VNode 的灵活性以及实现一些特殊 feature 的。由于 VNode 只是用来映射到真实 DOM 的渲染，不需要包含操作 DOM 的方法，因此它是非常轻量和简单的。vue的createElement就是用来创建Vnode的。</p> <h3 id="_7-virtual-dom变成真实dom有哪些过程？"><a href="#_7-virtual-dom变成真实dom有哪些过程？" aria-hidden="true" class="header-anchor">#</a> 7. Virtual DOM变成真实DOM有哪些过程？</h3> <p>Virtual DOM 除了它的数据结构的定义，映射到真实的 DOM 实际上要经历 VNode 的 create、diff、patch 等过程。</p> <h3 id="_8-为什么子组件会比父组件先挂载，先调用mounted方法？"><a href="#_8-为什么子组件会比父组件先挂载，先调用mounted方法？" aria-hidden="true" class="header-anchor">#</a> 8. 为什么子组件会比父组件先挂载，先调用mounted方法？</h3> <p>猜测因为是递归调用，深度优先，所以是先子组件，子组件属于父组件一部分</p> <h3 id="_9-请问可以在beforecreate钩子内通过this访问到data中定义的变量么，为什么以及请问这个钩子可以做什么？"><a href="#_9-请问可以在beforecreate钩子内通过this访问到data中定义的变量么，为什么以及请问这个钩子可以做什么？" aria-hidden="true" class="header-anchor">#</a> 9. 请问可以在beforeCreate钩子内通过this访问到data中定义的变量么，为什么以及请问这个钩子可以做什么？</h3> <p>是不可以访问的，因为在vue初始化阶段，这个时候data中的变量还没有被挂载到this上，这个时候访问值会是undefined。beforeCreate这个钩子在平时业务开发中用的比较少，而像插件内部的instanll方法通过Vue.use方法安装时一般会选在beforeCreate这个钩子内执行，vue-router和vuex就是这么干的。</p> <h3 id="_10-props初始化都做了什么？"><a href="#_10-props初始化都做了什么？" aria-hidden="true" class="header-anchor">#</a> 10.props初始化都做了什么？</h3> <p>props 的初始化主要过程，就是遍历定义的 props 配置。遍历的过程主要做两件事情：一个是调用 defineReactive 方法把每个 prop 对应的值变成响应式，可以通过 vm._props.xxx 访问到定义 props 中对应的属性。对于 defineReactive 方法，我们稍后会介绍；另一个是通过 proxy(Object.defineProperty的语法糖) 把 vm._props.xxx 的访问代理到 vm.xxx 上</p> <h3 id="_11-依赖收集？"><a href="#_11-依赖收集？" aria-hidden="true" class="header-anchor">#</a> 11.依赖收集？</h3> <ul><li>一个是 const dep = new Dep() 实例化一个 Dep 的实例，另一个是在 get 函数中通过 dep.depend 做依赖收集；</li> <li>其实很多人都分析过并了解到 Vue 有依赖收集的过程，但我几乎没有看到有人分析依赖清空的过程，其实这是大部分同学会忽视的一点，也是 Vue 考虑特别细的一点。
考虑到一种场景，我们的模板会根据 v-if 去渲染不同子模板 a 和 b，当我们满足某种条件的时候渲染 a 的时候，会访问到 a 中的数据，这时候我们对 a 使用的数据添加了 getter，做了依赖收集，那么当我们去修改 a 的数据的时候，理应通知到这些订阅者。那么如果我们一旦改变了条件渲染了 b 模板，又会对 b 使用的数据添加了 getter，如果我们没有依赖移除的过程，那么这时候我去修改 a 模板的数据，会通知 a 数据的订阅的回调，这显然是有浪费的。</li></ul> <h3 id="_12-nexttick？"><a href="#_12-nexttick？" aria-hidden="true" class="header-anchor">#</a> 12.nextTick？</h3> <p>在浏览器环境中，常见的 macro task 有 setTimeout、MessageChannel、postMessage、setImmediate；常见的 micro task 有 MutationObsever 和 Promise.then。
通过这一节对 nextTick 的分析，并结合上一节的 setter 分析，我们了解到数据的变化到 DOM 的重新渲染是一个异步过程，发生在下一个 tick。这就是我们平时在开发的过程中，比如从服务端接口去获取数据的时候，数据做了修改，如果我们的某些方法去依赖了数据修改后的 DOM 变化，我们就必须在 nextTick 后执行。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/14/2020, 4:15:25 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/react/reactInterview.html" class="prev">
          react常见问题
        </a></span> <span class="next"><a href="/blog/comprehensivePeripheral.html">
          移动端适配
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.8a76d55b.js" defer></script><script src="/assets/js/30.f6868954.js" defer></script>
  </body>
</html>
